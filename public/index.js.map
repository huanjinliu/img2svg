{"version":3,"file":"index.js","sources":["../dist/imageToSvg.esm.js","../../example/index.ts"],"sourcesContent":["const SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\n/**\n * 创建一个带矩形色块基本的svg\n * @param attrs 配置属性\n * @returns svg元素\n */\nconst createSvgElement = (attrs) => {\n    const { width, height, viewBox = `0 0 ${width} ${height}` } = attrs;\n    const svg = document.createElementNS(SVG_NAMESPACE, 'svg');\n    svg.setAttribute('viewBox', viewBox);\n    svg.setAttribute('width', `${width}`);\n    svg.setAttribute('height', `${height}`);\n    return svg;\n};\n/**\n * 创建一个填充色块路径区域\n * @param attrs 配置属性\n * @returns 路径区域\n */\nconst createPathElement = (attrs) => {\n    const { path, clipPaths = [], fill = '#000', opacity = 1 } = attrs;\n    const pathElement = document.createElementNS(SVG_NAMESPACE, 'path');\n    // 创建路径点\n    const createPath = (points) => points.reduce((result, point, index, arr) => {\n        if (index === 0)\n            return `M${point.x},${point.y}`;\n        const prePoint = arr[index - 1];\n        const nextPoint = arr[index + 1];\n        // 如果点居于中间则无需添加\n        if (prePoint && nextPoint) {\n            if (point.x === prePoint.x &&\n                point.x === nextPoint.x &&\n                ((point.y > prePoint.y && point.y < nextPoint.y) || (point.y < prePoint.y && point.y > nextPoint.y)))\n                return result;\n            if (point.y === prePoint.y &&\n                point.y === nextPoint.y &&\n                ((point.x > prePoint.x && point.x < nextPoint.x) || (point.x < prePoint.x && point.x > nextPoint.x)))\n                return result;\n        }\n        return result + ` L${point.x},${point.y}`;\n    }, '');\n    // 创建合并路径点\n    const d = [path, ...clipPaths].reduce((d, points, index) => {\n        const _d = createPath(points);\n        return index === 0 ? _d : `${d} ${_d}`;\n    }, '');\n    pathElement.setAttribute('d', d);\n    pathElement.setAttribute('fill', fill);\n    pathElement.setAttribute('fill-opacity', `${opacity}`);\n    pathElement.setAttribute('fill-rule', 'evenodd');\n    return pathElement;\n};\n\n/**\n * 获取图像某个位置像素的色彩值\n * @param imageData 图像像素数据\n * @param row 像素点所在行\n * @param col 像素点所在列\n * @returns 像素点色值(RGBA)\n */\nconst getPixelRGBA = (imageData, row, col) => {\n    const { data, width } = imageData;\n    const index = row * width * 4 + col * 4;\n    if (index < 0)\n        return;\n    return {\n        r: data[index],\n        g: data[index + 1],\n        b: data[index + 2],\n        // 这里为了保证透明度数值准确度，不转化为[0, 1]范围\n        a: data[index + 3],\n    };\n};\n\n/**\n * 遍历图像像素点\n * @param imageData 图像像素数据\n * @param handler 遍历处理方法\n */\nconst forEachImagePixel = (imageData, handler) => {\n    const { width, height } = imageData;\n    for (let row = 0; row < height; row++) {\n        for (let col = 0; col < width; col++) {\n            handler(row, col, getPixelRGBA(imageData, row, col));\n        }\n    }\n};\n\n/**\n * 两个色值是否相同\n */\nconst isSameColor = (color1, color2, options = {}) => {\n    const { float = 0, ignoreOpacity = false } = options;\n    return (Math.abs(color1.r - color2.r) <= float &&\n        Math.abs(color1.g - color2.g) <= float &&\n        Math.abs(color1.b - color2.b) <= float &&\n        (ignoreOpacity || Math.abs(color1.a - color2.a) <= float));\n};\n\n/**\n * 获取像素点最终所在色块区域\n * @param area 直属区域\n * @returns 最终的区域归属\n */\nconst getPixelBelongArea = (area) => {\n    let _area = area;\n    // 如果区域被融合进其他区域\n    while (_area === null || _area === void 0 ? void 0 : _area.within)\n        _area = _area.within;\n    return _area;\n};\n/**\n * 填充区域颜色\n * ① 遍历像素点\n * ② 每个像素点判断上左两个方向的像素点是否同色，如果是则“融合”区域，如果都没有则创建起始点\n * ④ 遍历完成后生成路径标签并填充区域\n */\nconst fillArea = (svg, imageData) => {\n    // 像素点数据\n    const pixelData = [];\n    // 从左到右、从上到下遍历像素\n    forEachImagePixel(imageData, (row, col, color) => {\n        var _a, _b;\n        if (!pixelData[row])\n            pixelData[row] = [];\n        // 完全透明的像素块，没有渲染成路径的必要\n        if (color.a === 0) {\n            pixelData[row].push({ color });\n            return;\n        }\n        // 上边像素点\n        const topPixel = (_a = pixelData[row - 1]) === null || _a === void 0 ? void 0 : _a[col];\n        // 左边像素点\n        const leftPixel = (_b = pixelData[row]) === null || _b === void 0 ? void 0 : _b[col - 1];\n        // 上边像素所在区域\n        const topArea = getPixelBelongArea(topPixel === null || topPixel === void 0 ? void 0 : topPixel.area);\n        // 左边像素所在区域\n        const leftArea = getPixelBelongArea(leftPixel === null || leftPixel === void 0 ? void 0 : leftPixel.area);\n        // 是否与上边区域颜色一样\n        const sameWithTop = topArea && isSameColor(topPixel.color, color);\n        // 是否与左边区域颜色一样\n        const sameWithLeft = leftArea && isSameColor(leftPixel.color, color);\n        // 根据不同情况执行不同的融合操作\n        const mergeHandles = {\n            sameNone: () => {\n                pixelData[row].push({\n                    color,\n                    area: {\n                        startPos: { row, col },\n                        outer: [\n                            { x: col, y: row },\n                            { x: col + 1, y: row },\n                            { x: col + 1, y: row + 1 },\n                            { x: col, y: row + 1 },\n                        ],\n                        inners: []\n                    }\n                });\n            },\n            sameWithTopOnly: () => {\n                if (!topArea)\n                    return;\n                const index = topArea.outer.findIndex(point => point.x === col &&\n                    point.y === row);\n                topArea.outer.splice(index, 0, { x: col + 1, y: row + 1 }, { x: col, y: row + 1 });\n                pixelData[row].push({\n                    color,\n                    area: topArea\n                });\n            },\n            sameWithLeftOnly: () => {\n                if (!leftArea)\n                    return;\n                let index = leftArea.outer.findIndex(point => point.x === col &&\n                    point.y === row);\n                leftArea.outer.splice(index + 1, 0, { x: col + 1, y: row }, { x: col + 1, y: row + 1 });\n                pixelData[row].push({\n                    color,\n                    area: leftArea\n                });\n            },\n            sameBothAndSameArea: () => {\n                if (!topArea)\n                    return;\n                const index = topArea.outer.findIndex(point => point.x === col && point.y === row);\n                topArea.outer.splice(index, 1, { x: col + 1, y: row + 1 });\n                pixelData[row].push({\n                    color,\n                    area: topArea\n                });\n            },\n            sameBothAndDiffArea: () => {\n                if (!leftArea || !topArea)\n                    return;\n                const topIndex = topArea.outer.findIndex(item => item.x === col && item.y === row);\n                const leftIndex = leftArea.outer.findIndex(item => item.x === col && item.y === row);\n                topArea.outer = topArea.outer\n                    .slice(0, topIndex)\n                    .concat([{ x: col + 1, y: row + 1 }], leftArea.outer.slice(leftIndex + 1), leftArea.outer.slice(0, leftIndex + 1), topArea.outer.slice(topIndex + 1));\n                topArea.inners = topArea.inners.concat(leftArea.inners);\n                leftArea.within = topArea;\n                pixelData[row].push({\n                    color,\n                    area: topArea\n                });\n            },\n            hollowArea: (leftIndex, rightTopIndex) => {\n                if (!leftArea)\n                    return;\n                const removePoints = leftArea.outer.splice(rightTopIndex, (leftIndex + 1) - rightTopIndex);\n                leftArea.inners.push(removePoints);\n                leftArea.outer.splice(rightTopIndex, 0, { x: col + 1, y: row }, { x: col + 1, y: row + 1 });\n                pixelData[row].push({\n                    color,\n                    area: leftArea\n                });\n            },\n            hollowAreaWithNewStart: (leftIndex, rightTopIndex) => {\n                if (!leftArea)\n                    return;\n                const newOuterPoints = leftArea.outer.splice(leftIndex + 1, rightTopIndex - (leftIndex + 1));\n                leftArea.inners.push(leftArea.outer);\n                leftArea.outer = newOuterPoints;\n                leftArea.startPos = { row, col };\n                leftArea.outer.push({ x: col + 1, y: row }, { x: col + 1, y: row + 1 });\n                pixelData[row].push({\n                    color,\n                    area: leftArea\n                });\n            },\n        };\n        if (sameWithLeft) {\n            if (sameWithTop) {\n                if (topArea === leftArea)\n                    mergeHandles.sameBothAndSameArea();\n                else\n                    mergeHandles.sameBothAndDiffArea();\n            }\n            else {\n                let index = leftArea.outer.findIndex(point => point.x === col &&\n                    point.y === row);\n                const rightTopIndex = leftArea.outer.findIndex(point => point.x === col + 1 &&\n                    point.y === row);\n                if (rightTopIndex !== -1) {\n                    if (index > rightTopIndex)\n                        mergeHandles.hollowArea(index, rightTopIndex);\n                    else\n                        mergeHandles.hollowAreaWithNewStart(index, rightTopIndex);\n                }\n                else\n                    mergeHandles.sameWithLeftOnly();\n            }\n        }\n        else if (sameWithTop)\n            mergeHandles.sameWithTopOnly();\n        else\n            mergeHandles.sameNone();\n    });\n    // 遍历色值数组\n    const { width, height } = imageData;\n    for (let row = 0; row < height; row++) {\n        for (let col = 0; col < width; col++) {\n            const pixel = pixelData[row][col];\n            const area = getPixelBelongArea(pixel.area);\n            // 没有绘制区域，跳出\n            if (!area)\n                continue;\n            const { color } = pixel;\n            const { startPos, outer, inners } = area;\n            // 不是区域绘制起始点，跳出\n            if (startPos.row !== row || startPos.col !== col)\n                continue;\n            svg.appendChild(createPathElement({\n                path: outer,\n                clipPaths: inners,\n                fill: `rgb(${color.r}, ${color.g}, ${color.b})`,\n                opacity: color.a / 255\n            }));\n        }\n    }\n};\n\n/**\n * 将图像转化为svg\n * @param image 图像节点\n * @returns\n */\nconst image2svg = (image) => {\n    const canvas = document.createElement('canvas');\n    canvas.width = image.naturalWidth;\n    canvas.height = image.naturalHeight;\n    const ctx = canvas.getContext('2d');\n    if (!ctx)\n        return;\n    // createTestImage(canvas, 3, 3, [\n    //   {\n    //     row: 0,\n    //     col: 0,\n    //     color: 'rgba(255, 0, 0, .5)'\n    //   },\n    //   {\n    //     row: 1,\n    //     col: 1,\n    //     color: 'rgba(255, 0, 0, .5)'\n    //   },\n    //   // {\n    //   //   row: 1,\n    //   //   col: 2,\n    //   //   color: 'rgba(255, 0, 0, .5)'\n    //   // },\n    //   // {\n    //   //   row: 1,\n    //   //   col: 3,\n    //   //   color: 'rgba(255, 0, 0, .5)'\n    //   // },\n    //   // {\n    //   //   row: 2,\n    //   //   col: 1,\n    //   //   color: 'rgba(255, 0, 0, .5)'\n    //   // },\n    //   // {\n    //   //   row: 2,\n    //   //   col: 3,\n    //   //   color: 'rgba(255, 0, 0, .5)'\n    //   // }\n    // ])\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(image, 0, 0);\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    // console.log(imageData)\n    const svg = createSvgElement({\n        width: canvas.width,\n        height: canvas.height,\n    });\n    // 方案一：填充每一个单位色块\n    // fillUnit(svg, imageData)\n    // 方案二：填充区域色块\n    fillArea(svg, imageData);\n    return { canvas, svg };\n};\n\nexport { image2svg as default };\n","import imageToSvg from 'image-to-svg';\n\nconst main = () => {\n  const sourceImage = document.querySelector('#source') as HTMLImageElement\n  const effect = document.querySelector('#effect') as HTMLDivElement\n\n  // sourceImage.onload = () => {\n  const result = imageToSvg(sourceImage)\n  if (result) {\n    const { canvas, svg } = result\n    // sourceImage.src = canvas.toDataURL()\n    effect.appendChild(svg)\n  }\n  // }\n}\n\nmain()\n"],"names":["SVG_NAMESPACE","createSvgElement","attrs","width","height","viewBox","svg","document","createElementNS","setAttribute","createPathElement","path","clipPaths","fill","opacity","pathElement","createPath","points","reduce","result","point","index","arr","x","y","prePoint","nextPoint","d","_d","getPixelRGBA","imageData","row","col","data","r","g","b","a","forEachImagePixel","handler","isSameColor","color1","color2","options","float","ignoreOpacity","Math","abs","getPixelBelongArea","area","_area","within","fillArea","pixelData","color","_a","_b","push","topPixel","leftPixel","topArea","leftArea","sameWithTop","sameWithLeft","mergeHandles","sameNone","startPos","outer","inners","sameWithTopOnly","findIndex","splice","sameWithLeftOnly","sameBothAndSameArea","sameBothAndDiffArea","topIndex","item","leftIndex","slice","concat","hollowArea","rightTopIndex","removePoints","hollowAreaWithNewStart","newOuterPoints","pixel","appendChild","image2svg","image","canvas","createElement","naturalWidth","naturalHeight","ctx","getContext","imageSmoothingEnabled","drawImage","getImageData","imageToSvg"],"mappings":"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"}